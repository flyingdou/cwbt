<!-- 引入过滤器 -->
<wxs src='../../utils/filters.wxs' module='filter' />
<!-- 页面开始 -->
<view class='content'>
      <!-- block1 -->
      <view class='block1'>

            <view class='line'>
                  <view class='title'>设备名称</view>
                  <view class='value'>{{workDetail.ename}}</view>
            </view>

            <view class='line' wx:if='{{user_priv == 2}}'>
                  <view class='title'>设备编码</view>
                  <view class='value'>{{workDetail.number}}</view>
            </view>
            
            <view class='line'>
                  <view class='title'>作业名称</view>
                  <view class='value'>{{workDetail.name}}</view>
            </view>

            <view class='line'>
                  <view class='title'>维修等级</view>
                  <view class='value'>临时</view>
            </view>

            <view class='line'>
                  <view class='title'>所属部门</view>
                  <view class='value'>{{workDetail.deptName}}</view>
            </view>

            <view class='line'>
                  <view class='title'>所属船舶</view>
                  <view class='value'>{{workDetail.boatName}}</view>
            </view>

            <view class='line'>
                  <view class='title'>维修方式</view>
                  <view class='value'>{{filter.overhaul(workDetail.overhaul_function)}}</view>
            </view>

            <view class = 'tagName'>异常情况</view>
            <view class='line'>
                  <view class='title'>异常时间</view>
                  <view class='value'>{{workDetail.createtime}}</view>
            </view>
            
            <!-- 异常图片 -->
            <view class='remark'>
                  <view class='title'>异常图片</view>
                  
                  <!-- 拍摄的照片 -->
                  <view class='shot'>
                        <view class='prePic' wx:for = '{{workDetail.image}}' wx:key='' bindtap='previewShot'  data-index = '{{index}}'>
                              <!-- 照片 -->
                              <view class='shotPic'>
                                    <image src='{{base_img_url + "/" + item.name}}' mode='aspectFill' ></image>
                              </view>
                              
                              <!-- 拍照时间 -->
                              <view class='pic_time'>{{item.pic_time}}</view>

                              
                        </view>
                  </view>


            </view>

            <!-- 异常描述 -->
            <view class='remark' wx:if = '{{!showMark}}'>
                  <view class='title'>异常描述</view>
                  <view class='task'>
                        <view class='value task-value' wx:if='{{!showExceptionalInput}}'>{{workDetail.exceptional_describe}}</view>
                        <textarea wx:if='{{isHidden && showExceptionalInput}}' placeholder='请输入设备维修反馈情况' maxlength='-1' placeholder-class='placeholderClass' class='textareaClass' bindinput='pickerChange' data-key = 'exceptional_describe' value='{{workDetail.exceptional_describe}}'></textarea>
                  </view>
            </view>
             
            <!-- 审批情况(审批情况显示(首先必须是委外维修,第一种情况：管理端大处未审批,已审批,已完成都可看，第二种情况管理端小处未审批不可看,已审批和已完成可看，第三种情况船舶端未审批不可看,已审批和已完成可看)) -->
            <view>
                  <view class='tagName'>审批情况</view>
                  <view class='line' bindtap='showMark' data-key = 'expectedtime' >
                        <view class='title'>预计完成时间</view>
                        <view class='line-right'>
                          <view class='value'>{{filter.subLen(workDetail.expectedtime, 10)}}</view>
                          <!-- <view class='moreIcon'>
                                <image mode='aspectFill' src='../../icon/more@2x.png'></image>
                          </view> -->
                        </view>
                  </view>

                  <view class='remark' wx:if = '{{!showMark}}'>
                        <view class='title'>审批意见</view>
                        <textarea maxlength='-1' placeholder='{{disablex ? "无" : "请输入审批意见"}}' placeholder-class='placeholderClass' class='textareaClass' bindinput='pickerChange' data-key = 'auditNote' value='{{workDetail.audit_note}}' disabled='{{disablex}}' wx:if='{{hidden}}'></textarea>
                  </view>
            </view>

            <!-- 正常的执行过程描述 -->
            <block wx:if = '{{isScan}}'>
              <view class='tagName'>填写执行情况</view>
              <!-- <view class='line'>
                    <view class='title'>设备状况</view>
                    <picker range='{{statusList}}' range-key='name' bindchange='pickerChange' data-key = 'status' >
                            <view class='item'>
                                  <view class='value'>{{status == 0 ? "正常" : "异常"}}</view>
                                  <view class='moreIcon'>
                                        <image src='../../icon/more@2x.png'></image>
                                  </view>
                            </view>
                    </picker>
              </view> -->
              <view class='remark'>
                    <view class='title'>执行过程描述</view>
                    <textarea placeholder='请输入执行过程描述信息' maxlength='-1' placeholder-class='placeholderClass' class='textareaClass' bindinput='pickerChange' data-key = 'mark' value='{{workFeedback.mark}}'></textarea>
              </view>
              <!-- 正常执行时的照片 -->
              <view class='preview'>
                    <!-- 正常执行时的照片 -->
                    <view class='pic' wx:for = '{{photos}}' wx:key='' bindtap='preview' bindlongtap='deletePic' data-index = '{{index}}'>
                          <image src='{{item.tempFilePath ?  item.tempFilePath : base_img_url + "/" + item.name}}' mode='aspectFill' ></image>
                    </view>

                    <view class='pic'>
                          <image src='{{needPhoto ? "../../icon/redAdd.png" : "../../icon/add.png"}}' mode='aspectFill'  bindtap='photo' data-key = 'photos' ></image>
                    </view>
              </view>
            </block>
      </view>
</view>

<!-- 填充高度 -->
<view class='fill'></view>
            
<!-- 底部按钮 -->
<view class='buttons' wx:if = '{{collectorpersonid && collectorpersonid == user_id}}'>
      <view wx:if = '{{!isScan}}' class='button scanButton' bindtap='sure' >填写执行情况</view>
      <view wx:if = '{{isScan}}' class='button finshButton' bindtap='uploadPictures' data-key = 'photos' data-fun='finish'>提交</view>
</view>

<!-- 弹出层 -->
<modal catchtouchmove = 'true' hidden = '{{hidden}}' title = '提示' confirm-text = '确定' cancel-text = '取消' bindconfirm = 'confirm2' bindcancel = 'cancel2'>
       <view class='block'>将要扫描设备条码，用以验证设备，确定吗？</view>
</modal>